# Function to recursively search for PST files and check for corresponding TRG files
function FindMatchingFiles {
    param(
        [string]$Path
    )

    # Get all PST files in the current directory
    $pstFiles = Get-ChildItem -Path $Path -Filter *.pst -File

    # Loop through each PST file
    foreach ($pstFile in $pstFiles) {
        # Check if a TRG file with the same name exists in the same directory
        $trgFile = Get-ChildItem -Path $pstFile.Directory.FullName -Filter ($pstFile.BaseName + ".trg") -File

        # If a matching TRG file exists, output the path of the PST file
        if ($trgFile) {
            Write-Output $pstFile.FullName
        }
    }

    # Recursively search subdirectories
    $subDirectories = Get-ChildItem -Path $Path -Directory
    foreach ($directory in $subDirectories) {
        FindMatchingFiles -Path $directory.FullName
    }
}

# Starting directory for the search
$startingDirectory = "C:\path\to\search"

# Call the function to start the search
FindMatchingFiles -Path $startingDirectory
