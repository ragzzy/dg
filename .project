# Ensure the Az module is installed
# If not installed, run: Install-Module -Name Az -Scope CurrentUser -Repository PSGallery -Force

# Import the Az module
Import-Module Az

# Function to invoke Azure Data Factory pipeline
function Invoke-AdfPipeline {
    param (
        [Parameter(Mandatory=$true)]
        [string]$ResourceGroupName,

        [Parameter(Mandatory=$true)]
        [string]$DataFactoryName,

        [Parameter(Mandatory=$true)]
        [string]$PipelineName,

        [Parameter(Mandatory=$true)]
        [hashtable]$Parameters
    )

    try {
        # Connect to Azure (you'll be prompted to log in if not already authenticated)
        Connect-AzAccount

        # Invoke the pipeline
        $runId = Invoke-AzDataFactoryV2Pipeline `
            -ResourceGroupName $ResourceGroupName `
            -DataFactoryName $DataFactoryName `
            -PipelineName $PipelineName `
            -Parameter $Parameters

        Write-Host "Pipeline invoked successfully. Run ID: $runId"
        return $runId
    }
    catch {
        Write-Error "An error occurred: $_"
        return $null
    }
}

# Example usage
$resourceGroup = "YourResourceGroupName"
$dataFactory = "YourDataFactoryName"
$pipeline = "YourPipelineName"
$params = @{
    "param1" = "value1"
    "param2" = "value2"
}

$runId = Invoke-AdfPipeline -ResourceGroupName $resourceGroup `
                            -DataFactoryName $dataFactory `
                            -PipelineName $pipeline `
                            -Parameters $params

if ($runId) {
    Write-Host "Pipeline run started. You can monitor the pipeline run using the Azure portal or Azure PowerShell."
}
